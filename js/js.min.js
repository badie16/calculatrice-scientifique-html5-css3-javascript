var x = 0,
    op = null,
    modif = false, //est-ce que l'ecran a été modifié depuis le dernier calcul.
    M = 0,
    y = null,
    ecran = document.getElementsByName('box_resultat')[0],
    mem = document.getElementsByName('memory')[0],
    derniere_touche = null;

function saisie(c) {
    var temp = parseFloat(ecran.value + c);
    ecran.value = (modif === true) ? (temp ? temp : c) : c;
    modif = true;
}

function reset() {
    x = ecran.value = 0;
    op = null;
}

function memoire(n) {
    var temp = parseFloat(ecran.value);
    if (isNaN(temp)) return ecran.value = 0;
    switch (n) {
        case 1:
            return M = mem.value = temp ? temp : M;
        case 2:
            return ecran.value = M;
        case 3:
            return M = mem.value = 0;
        case 4:
            return mem.value = (M += temp);
    }
}

function eteindre() {
    x = M = 0;
    op = null;
    ecran.value = mem.value = '';
}

function scientific(n) {
    var temp = parseFloat(ecran.value);
    if (isNaN(temp)) return ecran.value = 0;
    modif = true;
    switch (n) {
        case 1:
            return ecran.value = Math.sqrt(temp);
        case 2:
            return ecran.value = Math.abs(temp);
        case 3:
            return ecran.value = Math.PI;
        case 4:
            return ecran.value = Math.sin(temp);
        case 5:
            return ecran.value = Math.cos(temp);
        case 6:
            return ecran.value = Math.tan(temp);
        case 7:
            return ecran.value = Math.log(temp);
        case 8:
            return ecran.value = Math.exp(temp);
        case 9:
            return ecran.value = Math.LN2;
        case 10:
            return ecran.value = Math.log(temp) / Math.log(10);
        case 11:
            return ecran.value = Math.asin(temp);
        case 12:
            return ecran.value = Math.acos(temp);
        case 13:
            return ecran.value = Math.atan(temp);
        case 14:
            return ecran.value = temp * temp;
        case 15:
            return ecran.value = factorielle(temp | 0);
        case 16:
            return ecran.value = temp * (-1);
        case 17:
            return ecran.value = Math.pow(10, temp);
        case 18:
            return ecran.value = 1 / temp;
        case 19:
            modif = 'percent';
            return ecran.value = x * temp / 100;
    }
}

function Operation(newOp) {
    var temp = parseFloat(ecran.value);
    if (isNaN(temp)) return ecran.value = 0;
    if (!op) {
        x = temp;
        op = newOp;
        modif = false;
        return
    }
    if (!modif) return op = newOp;
    x = calcul(x, op, temp);
    op = newOp;
    modif = false;
}

function calcul(x, op, y) {
    switch (op) {
        case '/':
            return x / y;
        case '*':
            return x * y;
        case 'pow':
            return Math.pow(x, y);
        case '-':
            return x - y;
        case '+':
            return x + y;
    }
}

function factorielle(x) {
    return x <= 1 ? 1 : x * factorielle(x - 1);
}

function egal(e) {
    var temp = parseFloat(ecran.value);
    if (isNaN(temp)) return ecran.value = 0;
    if (!op) return modif = false;
    if (derniere_touche != e) y = temp;
    ecran.value = calcul(x, op, y);
    modif = false;
    op = null;
}

document.addEventListener('click', function (e) {
    if (e.srcElement.tagName === 'INPUT') derniere_touche = e.srcElement;
}, false);

ecran.onchange = function () {
    modif = true;
};

window.saisie = saisie;
window.egal = egal;
window.Operation = Operation;
window.reset = reset;
window.memoire = memoire;
window.eteindre = eteindre;
window.scientific = scientific;
